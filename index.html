<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyA01ppcnmR___c1-bN1Zz3VfNy9ke7LomA",
    authDomain: "advent-calendar-574ec.firebaseapp.com",
    databaseURL: "https://advent-calendar-574ec-default-rtdb.firebaseio.com",
    projectId: "advent-calendar-574ec",
    storageBucket: "advent-calendar-574ec.appspot.com",
    messagingSenderId: "575683037336",
    appId: "1:575683037336:web:c5f1c9579c8c93d63568ed"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const USER_ID = "boyfriend";
  const calendar = document.getElementById("calendar");
  const modalBg = document.getElementById("modalBg");
  const modalTitle = document.getElementById("modalTitle");
  const modalContent = document.getElementById("modalContent");

  const month = 12;
  const day = 3;

  const messages = {
    1: "Message for Day 1 â™¥",
    2: "Message for Day 2 â™¥",
    3: "Message for Day 3 â™¥",
    25: "Merry Christmas, my love! ðŸŽ„â™¥"
  };

  // TESTING: simulate opened boxes
  let openedDays = [1, 3];

  function renderCalendar() {
    calendar.innerHTML = "";
    for (let i = 1; i <= 25; i++) {
      const box = document.createElement("div");
      box.classList.add("day");
      box.textContent = i;

      if (openedDays.includes(i)) {
        box.classList.add("opened");
        box.onclick = () => openModal(i);
      } else {
        box.classList.add("available");
        box.onclick = () => openToday(i);
      }

      calendar.appendChild(box);
    }
  }

  function openToday(day) {
    if (!openedDays.includes(day)) {
      openedDays.push(day);
      // optional: sync to Firebase
      set(ref(db, `users/${USER_ID}/openedDays`), openedDays);
    }
    openModal(day);
  }

  function openModal(day) {
    modalTitle.textContent = `Day ${day}`;
    modalContent.textContent = messages[day] || "No message yet.";
    modalBg.style.display = "flex";
  }

  function closeModal() {
    modalBg.style.display = "none";
  }

  renderCalendar(); // render immediately

  // Snowflakes
  function createSnowflakes() {
    setInterval(() => {
      const snowflake = document.createElement('div');
      snowflake.classList.add('snowflake');
      snowflake.textContent = 'â„';
      snowflake.style.left = Math.random() * 100 + 'vw';
      snowflake.style.animationDuration = 5 + Math.random() * 7 + 's';
      snowflake.style.fontSize = 10 + Math.random() * 20 + 'px';
      document.body.appendChild(snowflake);
      setTimeout(() => snowflake.remove(), 12000);
    }, 400);
  }
  createSnowflakes();
</script>


